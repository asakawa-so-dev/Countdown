<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>営業日カウントダウン</title>
<meta name="robots" content="noindex" />
<style>
  :root { --bg:#ffffff; --fg:#111; --muted:#888; }
  html,body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--fg);
    font-family: "Noto Sans JP", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
  }
  .wrap {
    min-height: 100%;
    display: grid;
    place-items: center;
    padding: 24px;
  }
  .title { font-weight: 600; letter-spacing: .04em; margin-bottom: 18px; }
  .grid {
    display: grid;
    grid-auto-flow: column;
    gap: 16px;
  }
  .box {
    width: 96px; height: 110px; border-radius: 14px;
    background: #111; color: #fff;
    display: grid; place-items: center;
    box-shadow: 0 6px 18px rgba(0,0,0,.18);
  }
  .value { font-size: 2.7rem; line-height: 1; font-weight: 800; }
  .label { font-size: .8rem; color: #bbb; letter-spacing: .08em; }
  .note { margin-top: 14px; font-size: .85rem; color: var(--muted); }
  @media (max-width: 540px) {
    .box { width: 80px; height: 96px; }
    .value { font-size: 2.2rem; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div>
      <div class="title">営業日カウントダウン</div>
      <div class="grid">
        <div class="box"><div class="value" id="days">--</div><div class="label">Days</div></div>
        <div class="box"><div class="value" id="hours">--</div><div class="label">Hours</div></div>
        <div class="box"><div class="value" id="minutes">--</div><div class="label">Minutes</div></div>
        <div class="box"><div class="value" id="seconds">--</div><div class="label">Seconds</div></div>
      </div>
      <div class="note">※ 土日＋日本の祝日を除外して計算</div>
    </div>
  </div>

<script>
  // ← 締切日時をここで設定（ローカルタイムでOK）
  const targetDate = new Date("2025-12-31T23:59:59");

  async function getHolidays(year) {
    const res = await fetch(`https://holidays-jp.github.io/api/v1/${year}/date.json`, { cache: "no-store" });
    const data = await res.json();
    return Object.keys(data); // ["2025-01-01", ...]
  }

  function isBusinessDay(date, holidays) {
    const day = date.getDay();
    const yyyy_mm_dd = date.toISOString().split("T")[0];
    return day !== 0 && day !== 6 && !holidays.includes(yyyy_mm_dd);
  }

  function countBusinessDays(from, to, holidays) {
    let count = 0;
    const cur = new Date(from.getFullYear(), from.getMonth(), from.getDate()); // 時刻を00:00に寄せてズレ防止
    const end = new Date(to.getFullYear(), to.getMonth(), to.getDate());
    while (cur <= end) {
      if (isBusinessDay(cur, holidays)) count++;
      cur.setDate(cur.getDate() + 1);
    }
    return count;
  }

  async function render() {
    const now = new Date();
    const y = now.getFullYear(), ny = targetDate.getFullYear();
    const holidays = [
      ...(await getHolidays(y)),
      ...(y !== ny ? await getHolidays(ny) : []),
    ];

    const businessDaysLeft = countBusinessDays(now, targetDate, holidays);
    const diff = Math.max(0, targetDate - now);

    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((diff / (1000 * 60)) % 60);
    const seconds = Math.floor((diff / 1000) % 60);

    document.getElementById("days").textContent = businessDaysLeft;
    document.getElementById("hours").textContent = String(hours).padStart(2, "0");
    document.getElementById("minutes").textContent = String(minutes).padStart(2, "0");
    document.getElementById("seconds").textContent = String(seconds).padStart(2, "0");
  }

  render();
  setInterval(render, 1000);
</script>
</body>
</html>
